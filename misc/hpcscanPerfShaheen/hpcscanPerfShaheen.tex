%%% Local Variables: 
%%% mode: latexTeX-master: t
%%% End: 
\documentclass[usenames,dvipsnames]{beamer}
\usepackage{graphicx}
\usepackage{natbib}
%\usepackage[latin1]{inputenc}
%\usepackage[french]{babel}
%\usepackage[T1]{fontenc}
%\usepackage{verbatim}
\usepackage[normalem]{ulem}
\usepackage{amsmath}
%\usepackage{beamerthemeMadrid}
%\usecolortheme{albatross}
%\usepackage{beamerthemeBoadilla} %pas mal du tout
%\usetheme{JuanLesPins}
\usetheme{Madrid}
%\usetheme{Bergen}
\DeclareMathAlphabet{\mathsl}{OT1}{cmss}{m}{sl}
\usepackage{color}
\usepackage{multicol}
%\usepackage{algorithms/algorithm}
%\usepackage{algorithms/algorithmic}
\usepackage{epsfig}
\usepackage{natbib}
\usepackage{graphicx}              % image
%\usepackage{here}                  % positionement facile des figures
%\usepackage[latin1]{inputenc}      % pour les caracteres accentuÃ©s
%\usepackage[utf8x]{inputenc}
%\usepackage[francais]{babel}
%\usepackage[cyr]{aeguill}  %package permettant la cesure des mots franÃ§ais
%avec utilisation de font T1 avec bon rendu en pdf
%\usepackage[T1]{fontenc}
%\usepackage{lmodern}
\usepackage{fancyhdr}              %gestion entete /pied de pages
\usepackage{amsmath}
\usepackage{amsfonts}
%include pdf page
\usepackage{pdfpages}
\usepackage{fancybox}
\usepackage{pifont}
%\usepackage{multirow}

\usepackage{caption}

\definecolor{brique}{rgb}{0.5,0.2,0.4} 
\definecolor{highlight}{rgb}{1.,0.4,0.}

\newcommand{\RR}{\hbox{\cal I\hspace{-2pt}R}}
\newcommand{\ket}{\right\rangle}       
\newcommand{\bra}{\left\langle}

%\setbeamerfont{frametitle}{series=\bfseries,size=\large,fg=white}
\setbeamerfont{frametitle}{series=\bfseries,size=\large}
\setbeamercolor{structure}{bg=white, fg=brique}

%-------------------------------------------------------------------------------------

\title[hpcscan benchmarks on Shaheen II]{hpcscan version 1.1 \\ Performance benchmarks on Shaheen II (KAUST)}
%\subtitle{}
%\author[Vincent Etienne]{Vincent Etienne}
%\institute[]{XX}

\date[Dec 2020] {\small{December 2020 }}

%-------------------------------------------------------------------------------------

\bibliographystyle{apalike}


\AtBeginSection[ ]
{
\begin{frame}<beamer>
\frametitle{Content}
\tableofcontents[currentsection]
\end{frame}
}

%\AtBeginSubsection[ ]
%{
%\begin{frame}<beamer>
%\frametitle{Content}
%\tableofcontents[currentsection,currentsubsection]
%\end{frame}
%}

%\titlegraphic{\vspace{-0.75cm} \center
%\pgfimage[height=2.cm]{logo/logo_complet.pdf}}

\begin{document}
\scriptsize

\maketitle 

\clearpage

\frame{
\frametitle{Content}
\tableofcontents }

%*************************************************************************************

\section{Introduction}

%*************************************************************************************

%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Introduction}

  This document presents a characterization of the computing nodes and interconnect of the KAUST supercomputer Shaheen II.
  The full set of test cases embedded in \texttt{hpcscan} is used in various configurations.
  
  {\tiny
  \begin{block}{\center List of test cases in this study}

  \begin{table}
    %\caption*{\scriptsize {List of test cases}}
    \label{table_testCases}
    \begin{tabular}{@{}ccc}
      Test Case & Objectives & Remark \\
      \hline
      Memory & Assess memory bandwidth & Scalability analysis on a single node \\
      Grid & Assess bandwidth of grid operations &  Analyse effect of the grid size \\
      Comm & Assess inter-node communication bandwidth & Analyse effect of subdomain decomposition \\
      FD\_D2 & Assess FD spatial derivative computation bandwidth & Analyse effect of FD stencil order \\
      Propa & Find optimal configuration for the wave propagator & Explore range of parameters \\
      Propa & Scalability analysis of wave propagator on multiple nodes & Analyse effect of the FD stencil order \\
    \end{tabular}
  \end{table}
  \end{block}

  \begin{block}{\center General settings}
    \begin{itemize}
    \item All tests are performed in single precision
    \item Best performance is reported over 10 tries for each case (unless stated otherwise)
    \item Grids dimensions are 3D
    \item Grids sizes are from 500 MB up to 4 GB per node
    \end{itemize}
  \end{block}
  }
  }
%-------------------------------------------------------------------------------------

%*************************************************************************************

\section{Shaheen II (KAUST)}

%*************************************************************************************

%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Shaheen II (KAUST)}

  \begin{block}{\center Machine Shaheen II / Cray XC40}

  \scriptsize
  \begin{itemize}
  \item Computing nodes Intel Haswell 2.3 Ghz dual socket (16 cores / socket)
  \item RAM 128 GB with Peak memory BW 136.5 GB/s
  \item Peak performance Single Prec. 2.36 TFLOP/s / Double Prec. 1.18 TFLOP/s
  \item Interconnect Cray Aries with Dragonfly topology
    \begin{itemize}
    \item \scriptsize 60 GB/s optical links between groups
    \item \scriptsize 8.5 GB/s copper links between chassis
    \item \scriptsize 3.5 GB/s backplane within a chassis
    \item \scriptsize 5 GB/s PCIe from node to Aries router
    \end{itemize}
  \end{itemize}

  \end{block}

  \begin{figure}
    \begin{center}
      \includegraphics[width=0.5 \textwidth]{./Images/Shaheen-II.png}
    \end{center}
  \end{figure}
}

%*************************************************************************************

\section{Test Case Memory}

%*************************************************************************************

%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Test Case Memory - Description}

  \begin{block}{\center Benchmark objective}
    \textcolor{Sepia}{\bf Assess memory bandwidth}
    \begin{itemize}
    \item Measure GByte/s and GPoint/s for simple operations on memory arrays
    \item Scalability analysis on a single node
    \item Get a reference to compare with for the following tests
  \end{itemize}
  \end{block}

  \begin{block}{\center Benchmark configuration}
    \begin{itemize}
    \item Scalability on 1 node with 1 to 32 threads
    \item Baseline kernel
    \item Grid size 4 GB (1000 x 1000 x 1000 points)
    \item Reproduce results with \texttt{./script/testCase\_Memory/hpcscanMemory.sh}
    \item Total 10 configurations, Elapsed time about 4 minutes
    \end{itemize}
  \end{block}
}

%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Test Case Memory - Results \footnote{\scriptsize \textcolor{blue}{Updated Dec 22, 2020}} }

  \begin{figure}
    \begin{center}
      \includegraphics[width=1.0 \textwidth]{../../script/testCase_Memory/hpcscanMemoryShaheen.jpg}
    \end{center}
  \end{figure}
}

%*************************************************************************************

\section{Test Case Grid}

%*************************************************************************************

%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Test Case Grid - Description}

  \begin{block}{\center Benchmark objective}
    \textcolor{Sepia}{\bf Assess bandwidth of grid operations}
    \begin{itemize}
    \item Measure GByte/s and GPoint/s for simple and complex operations on 3D grids
    \item Analyse effect of the grid size
    \end{itemize}
  \end{block}

  \begin{block}{\center Benchmark configuration}
    \begin{itemize}
    \item 1 node with 32 threads
    \item Baseline kernel
    \item 2 grid sizes
      \begin{itemize}
      \item \scriptsize Small size 500 MB (500 x 500 x 500 points)
      \item \scriptsize Medium size 4 GB (1000 x 1000 x 1000 points)
      \end{itemize}
    \item Reproduce results with \texttt{./script/testCase\_Grid/hpcscanGrid.sh}
    \item Total 2 configurations, Elapsed time less than 1 minute
    \end{itemize}
  \end{block}
  
}

%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Test Case Grid - Results \footnote{\scriptsize \textcolor{blue}{Updated Dec 23, 2020}} }

  \center \tiny  Blue=small grid, Red=medium grid
  
  \begin{figure}
    \begin{center}
      \includegraphics[width=1.0 \textwidth]{../../script/testCase_Grid/hpcscanGridShaheen.jpg}
    \end{center}
  \end{figure}

  ApplyBoundaryCondition performs at 713/846 GBytes (89/105 Gpoint/s)
}

%*************************************************************************************

\section{Test Case Comm}

%*************************************************************************************

%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Test Case Comm - Description}

  \begin{block}{\center Benchmark objective}
    \textcolor{Sepia}{\bf Assess inter-node communication bandwidth}
  
    \vspace{0.25cm}
    MPI point to point communication
    \begin{itemize}
    \item Send with MPI\_Send from proc X to proc 0 (Half-duplex BW)
    \item Send and receive with MPI\_Sendrecv between proc X and proc 0 (Full-duplex BW)
    \end{itemize}

    MPI collective communication
    \begin{itemize}
    \item Exhange of halos used in FD kernels with MPI\_Sendrecv
    \item Analyse effect of subdomain decomposition geometry
    \end{itemize}
  \end{block}

  \begin{block}{\center Benchmark configuration}
    \begin{itemize}
    \item 8 nodes with 1 MPI/node \& 32 threads/node
    \item Baseline kernel
    \item Grid size 4 GB (1000 x 1000 x 1000 points)
    \item FD order O8
    \item Subdomain decomposition: 1x4x2 / 1x2x4 \& 2x2x2
    \item Reproduce results with \texttt{./script/testCase\_Comm/hpcscanComm.sh}
    \item Total 3 configurations: Elapsed time less than 1 minute
    \end{itemize}
  \end{block}
}


%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Test Case Comm - Results \footnote{\scriptsize \textcolor{blue}{Updated Dec 26, 2020}} }

  \begin{figure}
    \begin{center}
      \includegraphics[width=1.0 \textwidth]{../../script/testCase_Comm/hpcscanCommShaheen.jpg}
    \end{center}
  \end{figure}

}

%*************************************************************************************

\section{Test Case FD\_D2}

%*************************************************************************************

%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Test Case FD\_D2 - Description}

  \begin{block}{\center Benchmark objective}
    \textcolor{Sepia}{\bf Assess FD spatial derivative computation bandwidth}
    \begin{itemize}
    \item Directionnal derivatives
      \begin{itemize}
      \item {\tiny Axis 1, $W = \partial^2_{x1} (U)$}
      \item {\tiny Axis 2, $W = \partial^2_{x2} (U)$}
      \item {\tiny Axis 3, $W = \partial^2_{x3} (U)$}
      \end{itemize}
    \item Laplacian $W = \Delta (U)$
    \item Analyse effect of FD stencil order
    \item Try different implementations of FD computation
    \end{itemize}
  \end{block}

  \begin{block}{\center Benchmark configuration}
    \begin{itemize}
    \item 1 node with 32 threads
    \item 2 test modes: Baseline \& CacheBlk
    \item Grid size 4 GB (1000 x 1000 x 1000 points)
    \item FD orders 2, 4, 8, 12 \& 16
    \item Reproduce results with \texttt{./script/testCase\_FD\_D2/hpcscanFD\_D2.sh}
    \item Total 10 configurations: Elapsed time about 2 minutes
    \end{itemize}
  \end{block}
}

%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Test Case FD\_D2 - Results \footnote{\scriptsize \textcolor{blue}{Updated Dec 24, 2020}} }

  \begin{figure}
    \begin{center}
      \includegraphics[width=0.8 \textwidth]{../../script/testCase_FD_D2/hpcscanFD_D2Shaheen.jpg}
    \end{center}
  \end{figure}
}

%*************************************************************************************

\section{Test Case Propa}

%*************************************************************************************

%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Test Case Propa - Description}

  \begin{block}{\center Benchmark objective}
    \textcolor{Sepia}{\bf Find optimal configuration for the wave propagator regarding accuracy/cost}
    \begin{itemize}
    \item Explore range of grid sampling
    \item Explore range of time step
    \item Explore range of FD order
    \item Try different implementations of the propagator
    \end{itemize}
    
  \end{block}

  \begin{block}{\center Benchmark configuration}
    \begin{itemize}
    \item 1 node with 32 threads
    \item Test mode CachBlk
    \item 2 propagator implementations: Ac2Standard and Ac2SplitComp
    \item FD orders 4, 8 \& 12
    \item Time step 100, 50 and 10\% of stability time step
    \item Grid size from 500x500x500 (500 MB) to 1000x1000x1000 (4 GB)
    \item nt from 101 to 2311 (depending of the configuration) \& ntry = 4
    \item Reproduce results with \texttt{./script/testCase\_Propa/paramAnalysis/hpcscanPropaParamAnalysis.sh}
    \item Total 108 configurations: Elapsed time about 12 hours
    \end{itemize}
  \end{block}
}

%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Test Case Propa - Results \footnote{\scriptsize \textcolor{blue}{Updated Dec 28, 2020}} }

  \center \tiny Blue=FD O4, Pink=FD O8,Red=FD O12 / Square=Ac2Standard, Cross=Ac2SplitComp
  
   \begin{figure}
    \begin{center}
      \includegraphics[width=0.7 \textwidth]{../../script/testCase_Propa/paramAnalysis/hpcscanPropaParamAnalysisShaheen.jpg}
    \end{center}
  \end{figure}

}

%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Test Case Propa - Description}

  \begin{block}{\center Benchmark objective}
    \textcolor{Sepia}{\bf Scalability analysis of the wave propagator on multiple nodes}
    \begin{itemize}
    \item Strong and weak scalability
    \item Analyse effect of the FD stencil order
    \end{itemize}
    
  \end{block}

  \begin{block}{\center Benchmark configuration}
    \begin{itemize}
    \item From 1 node to 8 nodes with 32 threads/node
    \item Test mode CachBlk
    \item Propagator implementation Ac2Standard
    \item FD orders 4, 8 \& 12
    \item Strong scalability: Grid size 1000x1000x1000 (4 GB)
    \item Weak scalability: Grid size from 1000x1000x1000 (4 GB) to 1000x4000x2000 (32 GB)
    \item nt = 100
    \item Reproduce results with \texttt{./script/testCase\_strongWeakScalability/hpcscanPropaStrongWeakScalability.sh}
    \item Total 30 configurations: Elapsed time about 1h 15min
    \end{itemize}
  \end{block}
}


%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Test Case Propa - Results \footnote{\scriptsize \textcolor{blue}{Updated Dec 28, 2020}} }

  \begin{figure}
    \begin{center}
      \includegraphics[width=1.0 \textwidth]{../../script/testCase_Propa/strongWeakScalability/hpcscanPropaStrongWeakScalabilityShaheen.jpg}
    \end{center}
  \end{figure}
}

%*************************************************************************************

\section{Summary}

%*************************************************************************************

%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Summary}

  \begin{block}{\center Test Case Memory}
    \begin{itemize}
    \item Measured memory BW between 91 to 122 GB/s (67-90 \% of peak BW)
    \item Low BW 59 GB/s for Fill (43 \% of peak BW)
    \item Multiply (= imaging condition) performs at 7.6 Gpoint/s
    \end{itemize}
  \end{block}

  \begin{block}{\center Test Case Grid}
    \begin{itemize}
    \item L1 Err., Get Min \& Max: 125 GB/s close to peak BW (92 \% Peak Mem. BW)
    \item {Low perf for Fill: 54-58 GB/s (40-43 \% Peak Mem. BW)}
    \item Max Err. 72-91 GB/s (53-67 \% Peak Mem. BW)
    \item Pressure update 6 GPoint/s (120 GB/s, 88 \% Peak Mem. BW)
    \end{itemize}
  \end{block}
  }
%-------------------------------------------------------------------------------------

%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Summary}

  \begin{block}{\center Test Case Comm}
    \begin{itemize}
    \item TO DO
    \end{itemize}
  \end{block}
}
%-------------------------------------------------------------------------------------

%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Summary}
  
  \begin{block}{\center Test Case FD\_D2}
    \begin{itemize}
    \item Large benefit of cache blocking
    \item Significant effect of grid dimnsion and index (very bad performance for n3 without cache blocking)
    \item Min BW 50 GFLOP/s ($\partial^2_{x3}$ O2) = 2 \% peak BW [apparent Mem. BW 150 GB/s]
    \item Max BW 370 GFLOP/s ($\Delta$ O8) = 16 \% peak BW [apparent Mem. BW 900 GB/s]
    \item Apparent Mem. BW 150-900 GB/s (110-660 \% Peak Mem. BW) = shows data in-cache effect
    \item Typical stencils of interest for geophysical applications
      \begin{itemize}
      \item {\scriptsize $\Delta$ O4  BW = 8-10 GPoint/s}
      \item {\scriptsize $\Delta$ O8  BW = 7-9 GPoint/s}
      \item {\scriptsize $\Delta$ O12 BW = 3-5 GPoint/s}
      \end{itemize}
    \item Parallel efficiency with 8 nodes 55 to 86 \% (depends on workload on Shaheen)
    \end{itemize}
  \end{block}
}
%-------------------------------------------------------------------------------------

%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Summary}

  \begin{block}{\center Test Case Propa}
    \begin{itemize}
    \item TO DO
    \end{itemize}
  \end{block}
}
%-------------------------------------------------------------------------------------

%*************************************************************************************

\section{Acknowledgements}

%*************************************************************************************

%-------------------------------------------------------------------------------------
\frame{
  \frametitle{Acknowledgements}
  \begin{itemize}
  \item KAUST ECRC and KSL for access and support on Shaheen II
  \end{itemize}
}

%-------------------------------------------------------------------------------------
%{\tiny{
%\def\newblock{\hskip .11em plus .33em minus .07em}
%\bibliographystyle{apalike}
%\bibliography{./biblioseiscope}
%}}

%\addtocounter{framenumber}{-4}

\end{document}

